Clear-Host

#Initialisation de mes variables
$emplacementFichierCsv = "C:\Users\admin\Desktop\SystemeExploitation-TP3\nom.csv"
$fichierCsv = Get-Content $emplacementFichierCsv
$groupeName = "Entreprise"
$group = Get-LocalGroup | Where-Object Name -eq "Entreprise" | Measure

#Création du groupe Entreprise
if ($group.Count -eq 1)
{
    Write-Host "Le groupe $groupeName existe déjà."
}
else
{
    Write-Host "Le groupe $groupeName est innexistant."
    Write-Host "Création du groupe $groupeName ...."
    New-LocalGroup -Name $groupeName
    Write-Host "Le groupe $groupeName a bien été créé."
}

foreach ($line in $fichierCsv) 
{
    $fullname = $line
    $firstName,$lastname = $fullname.Split(" ")
    $firstletter = $firstName[0]
    $username = ($firstletter+$lastname).ToLower()
    

    Get-LocalUser -Name $username

    New-LocalUser -Name $username -FullName $fullname -AccountExpires 2022-04-10 -Description "Ceci est le compte de $fullname." -NoPassword
    Add-LocalGroupMember -Group Entreprise -Member $username
    New-Item -ItemType Directory -Name $fullname -Path C:\Entreprise
    New-Item -ItemType File -Name "Bienvenue.txt" -Value "Bonjour $fullname, bienvenue dans votre dossier de notre Entreprise" -Path C:\Entreprise\$fullname

}

Write-Host Fin